<?php if (!defined('BASEPATH')) exit('No direct script access allowed');class Ad_config_model extends CI_Model{    public function __construct()    {        parent::__construct();        $this->load->model('file_model');    }    public function countRecord($table,$search = NULL){        $this->db->from($table);        if($table == 'type_posts') {            $this->db->where('is_delete', null);        }        if(!empty($search)){            if($search!=""){                if($table == 'type_posts') {                    $this->db->like('name', $search);                    $this->db->or_like('description', $search);                }            }        }        $total = $this->db->count_all_results();        return $total;    }    public function postTypeList($paging_limit,$page = NULL,$search,$data_filter = NULL){        $this->db->from('type_posts');        $this->db->where('is_delete',null);        if ($page !== null)        {            $begin = ($page - 1)*$paging_limit;            $this->db->limit($paging_limit, $begin);        }        if(!empty($search)){            if($search != ""){                $this->db->like('name',$search);                $this->db->or_like('description',$search);            }        }        $query = $this->db->get();        $result = $query->result_array();        if(count($result) > 0){            foreach($result as $key => $value){                $result[$key]['avatar_link'] = $this->file_model->getLinkFileById($value['avatar']);            }        }        return $result;    }    public function createPostType(){        $input = $this->input->post();        $file_id = $this->file_model->do_upload('type_posts',TRUE);        $typePostRecord = array(            'name' => $input['name'],            'description' => $input['description'],            'avatar' => $file_id,            'created_at' => getCurrentDate()        );        //save record        $isInsert = $this->db->insert('type_posts',$typePostRecord);        if(!$isInsert){            //delete avatar            $this->file_model->deleteFileById($file_id);            return false;        }        return true;    }    public function getPostTypeById($id){        $this->db->select('id, name, description, avatar');        $this->db->from('type_posts');        $this->db->where('id',$id); //not get emergency        $query = $this->db->get();        if($query->num_rows() > 0 ){            $result = $query->result_object();            if(count($result) > 0) {                $result[0]->avatar_id = $result[0]->avatar;                $result[0]->avatar = $this->file_model->getLinkFileById($result[0]->avatar);                return $result[0];            }        }        return array();    }    //  update post type --> update avatar--> not change link avatar --> performent of android cache very bad    /*public function updatePostType(){        $input = $this->input->post();        $this->file_model->do_update('type_posts',TRUE,$input['avatar_id']);        $typePostRecord = array(            'name' => $input['name'],            'description' => $input['description'],            'updated_at' => getCurrentDate()        );        //save record        $isUpdate = $this->db->update('type_posts',$typePostRecord,array('id' => $input['id']));        if(!$isUpdate){            return false;        }        return true;    }*/    // update post type --> create new file, change link    public function updatePostType(){        $input = $this->input->post();        //delete avatar old        $this->file_model->deleteFileById($input['avatar_id']);        $fileId = $this->file_model->do_upload('type_posts',TRUE);        $typePostRecord = array(            'name' => $input['name'],            'description' => $input['description'],            'updated_at' => getCurrentDate(),            'avatar' => $fileId        );        //save record        $isUpdate = $this->db->update('type_posts',$typePostRecord,array('id' => $input['id']));        if(!$isUpdate){            return false;        }        return true;    }    public function delPostType($id){        $data = array('is_delete' => 1);        $isDelete = $this->db->update('type_posts',$data,array('id' => $id));        if ($isDelete) {            return true;        } else {            return $this->getFieldById('type_posts','name',$id);        }    }    public function getFieldById($table,$field,$id){        $this->db->select($field);        $this->db->from($table);        $this->db->where('id',$id);        $query = $this->db->get();        $result = $query->result_array();        return $result[0];    }    }